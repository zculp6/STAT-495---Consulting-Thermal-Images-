# Plot Root Mean Squared Error of Prediction (RMSEP) vs number of predictors
validationplot(pcr_model, val.type = "RMSEP")
plot(RMSEP(pcr_model)$val[1,,],type="l")
points(RMSEP(pcr_model)$val[1,,], pch=16)
?pcr
# Plot Root Mean Squared Error of Prediction (RMSEP) vs number of predictors
validationplot(pcr_model, val.type = "RMSEP")
# Fit final model using optimal number of components
final_model <- pcr(mpg~., data=mtcars, scale = T, ncomp = 3)
summary(final_model)
# Predictions
pred <- predict(final_model, ncomp = opt_comp, newdata = mtcars)
# Predictions
pred <- predict(final_model, ncomp = 3, newdata = mtcars)
head(pred)
# PLS
pls_model <- plsr(mpg~., data=mtcars, scale=TRUE, validation = "CV")
summary(pls_model)
# Plot RMSEP vs number of components
validationplot(pls_model, val.type = "RMSEP")
summary(final_pls_model)
# Fit final PLS model with chosen number of components
final_pls_model <- plsr(mpg~., data=mtcars, scale = TRUE, ncomp = 1)
summary(final_pls_model)
library(pls)
pcr_fit <- pcr(Apps~., data=train, scale=TRUE, validation = "CV")
n_d <- 5
n_e <- 100
n_f <- 10000
p_j <- function(n){
1 - (1-1/n)^n
}
# n = 5
p_j(n_d)
# n = 100
p_j(n_e)
# n = 10000
p_j(n_f)
n_seq <- seq(1,10000, by=1)
p_seq <- sapply(n_seq, p_j)
tail(p_seq)
plot(p_seq, xlab = "n", ylab = "Probability jth observation is in sample")
store <- rep(NA, 10000)
for(i in 1:10000){
store[i] <- sum(sample(1:100,rep=TRUE) == 4) > 0
}
mean(store)
library(ISLR2)
library(boot)
set.seed(1234)
mod_6 <- glm(default~income+balance,data=Default,family=binomial)
summary(mod_6)
coef(mod_6)
boot.fn <- function(data, obs){
data <- data[obs,]
mod <- glm(default~income+balance,data=data,family=binomial)
betas <- c()
for (i in 1:length(coef(mod))-1){
betas[i] <- coef(mod)[i+1]
}
return(betas)
}
boot_est <- boot(Default, boot.fn, 1000)
library(tidyverse)
set.seed(1)
x <- rnorm(100)
y <- x - 2 * x^2 + rnorm(100)
plot(x,y)
dat <- data.frame(x,y)
poly_loocv <- function(dat){
MSE <- c()
for(degree in 1:4){
a <- glm(y ~ poly(x,degree),data = dat)
MSE[degree] <- cv.glm(dat, a)$delta[1]
}
return(MSE)
}
poly_loocv(dat)
set.seed(12345)
poly_loocv(dat)[[1]]
mod_1 <- glm(y ~ poly(x,1), data=dat)
summary(mod_1)
mod_2 <- glm(y ~ poly(x,2), data=dat)
summary(mod_2)
mod_3 <- glm(y ~ poly(x,3), data=dat)
summary(mod_3)
mod_4 <- glm(y ~ poly(x,4), data=dat)
summary(mod_4)
set.seed(1)
mu_hat <- mean(Boston$medv)
mu_hat
se_mu_hat <- sd(Boston$medv)/sqrt(nrow(Boston))
se_mu_hat
boot.fn <- function(data, index){
mu <- mean(data[index])
return(mu)
}
b_medv <- boot(Boston$medv, boot.fn, 1000)
t.test(Boston$medv)
sd_medv <- sd(b_medv$t)
CI_mu_hat <- b_medv$t0 + c(-1,1) * 2 * sd_medv
CI_mu_hat
med_hat <- median(Boston$medv)
med_hat
boot.fn <- function(data, index){
m <- median(data[index])
return(m)
}
m_medv <- boot(Boston$medv, boot.fn, 1000)
sd(m_medv$t)
mu_0.1 <- quantile(Boston$medv, 0.1)
mu_0.1
boot.fn <- function(data, index){
m <- quantile(data[index],0.1)
return(m)
}
q_medv <- boot(Boston$medv, boot.fn, 1000)
sd(q_medv$t)
library(glmnet)
set.seed(1)
partition <- sample(1:nrow(College), nrow(College)*0.7, replace = F)
train <- College[partition,]
test <- College[-partition,]
# e
library(pls)
pcr_fit <- pcr(Apps~., data=train, scale=TRUE, validation = "CV")
validationplot(pcr_fit, val.type = "RMSEP")
# f
pls_fit <- plsr(Apps~., data=train, scale=TRUE, validation = "CV")
validationplot(pls_fit, val.type = "RMSEP")
which.min(RMSEP(pcr_fit))
which.min(RMSEP(pcr_fit)$val[1,,])
which.min(RMSEP(psl_fit)$val[1,,])
# f
pls_fit <- plsr(Apps~., data=train, scale=TRUE, validation = "CV")
which.min(RMSEP(psl_fit)$val[1,,])
which.min(RMSEP(pls_fit)$val[1,,])
which.min(RMSEP(pcr_fit)$val[1,,])
pcr_pred <- predict(pcr_fit, test, ncomp=18)
pcr_fit <- pcr(Apps~., data=train, scale=TRUE, validation = "CV")
validationplot(pcr_fit, val.type = "RMSEP")
which.min(RMSEP(pcr_fit)$val[1,,])
validationplot(pcr_fit, val.type = "RMSEP")
which.min(RMSEP(pls_fit)$val[1,,])
pls_pred <- predict(pls_fit, test, ncomp=7)
mse_pls <- mean((y_test - pls_pred)^2)
pls_pred <- predict(pls_fit, test, ncomp=11)
mse_pls <- mean((y_test - pls_pred)^2)
set.seed(1)
library(glmnet)
# a
partition <- sample(1:nrow(College), nrow(College)*0.7, replace = F)
train <- College[partition,]
test <- College[-partition,]
# b
mod <- lm(Apps~., data=train)
preds <- predict(mod, newdata=test)
mse <- mean((test$Apps - preds)^2)
mse
# c
train_mat <- model.matrix(Apps~., data=train)
test_mat <- model.matrix(Apps~., data=test)
y_train <- train %>% pull(Apps)
y_test <- test %>% pull(Apps)
mod_ridge <- cv.glmnet(train_mat, y_train, alpha=0)
fit_best_ridge <- glmnet(train_mat,y_train,alpha=0,lambda = mod_ridge$lambda.1se)
pred_ridge <- predict(fit_best_ridge, newx = test_mat)
mse_ridge <- mean((y_test - pred_ridge)^2)
mse_ridge
# d
mod_lasso <- cv.glmnet(train_mat, y_train, alpha=1)
fit_best_lasso <- glmnet(train_mat,y_train,alpha=1,lambda = mod_lasso$lambda.1se)
pred_lasso <- predict(fit_best_lasso, newx = test_mat)
mse_lasso <- mean((y_test - pred_lasso)^2)
mse_lasso
coef(fit_best_lasso) # 3 nonzero coefficients
# e
library(pls)
pcr_fit <- pcr(Apps~., data=train, scale=TRUE, validation = "CV")
validationplot(pcr_fit, val.type = "RMSEP")
pcr_pred <- predict(pcr_fit, test, ncomp=17)
mse_pcr <- mean((y_test - pcr_pred)^2)
mse_pcr
summary(pcr_fit) # m = 17
# f
pls_fit <- plsr(Apps~., data=train, scale=TRUE, validation = "CV")
validationplot(pls_fit, val.type = "RMSEP")
which.min(RMSEP(pls_fit)$val[1,,])
pls_pred <- predict(pls_fit, test, ncomp=11)
mse_pls <- mean((y_test - pls_pred)^2)
mse_pls
summary(pls_fit) # m = 11
data.frame(Method = c("Linear", "Ridge", "LASSO", "PCR", "PLS"),
MSE = c(mse, mse_ridge, mse_lasso, mse_pcr, mse_pls)
) %>% arrange(MSE)
?pls
?pcr
library(pls)
?pls
?plsr
airplane <- factor(rep(1:8, each=4))
brand <- factor(rep(c("A", "B", "C", "D"), times=8))
tire_data <- data.frame(airplane, brand, wearRate)
# Homework 5 Q1 Be sure to pay attention to the input order here
wearRate <- c(4.02, 2.46, 2.06, 3.49, 4.50, 3.39, 2.91, 3.18,
2.73, 1.69, 2.37, 1.48, 3.74, 1.95, 3.39, 3.09,
3.21, 1.20, 1.72, 2.65, 2.53, 1.04, 2.52, 1.23,
3.07, 2.55, 2.42, 2.07, 3.10, 1.09, 2.22, 2.57)
airplane <- factor(rep(1:8, each=4))
brand <- factor(rep(c("A", "B", "C", "D"), times=8))
tire_data <- data.frame(airplane, brand, wearRate)
tire_data
model <- aov(wearRate ~ airplane + brand, data=tire_data)
summary(model)
TukeyHSD(model)
TukeyHSD(model)$brand
summary(model)
model_crd <- aov(wearRate~ brand, data=tire_data)
summary(model_crd)
rel_eff <- 0.5185/0.2503
rel_eff
summary(model_crd)
summary(model)
# model MSE from part a was 0.2503
r <- 10
g <- 4
v_crd = (r-1)*g
v_rcbd <- (r-1)(g-1)
v_rcbd <- (r-1)*(g-1)
MS_block <- 1.3232
MSE <- 0.2503
var_crd <- ((r-1)*MS_block + ((g-1) + (r-1)*(g-1)) * MSE)*((r-1)+(g-1)+(r-1)*(g-1))
eff <- ((v_rcbd + 1)*(v_crd + 3))/((v_rcbd + 3) * (v_crd + 1)) * (var_crd/var_rcbd)
summary(model)
var_crd
num <- (r-1)*MS_BLKS + ((g-1) + (r-1)*(g-1))*MSE
num <- (r-1)*MS_block + ((g-1) + (r-1)*(g-1))*MSE
denom <- (r-1) + (g-1) + (r-1)*(g-1)
var_crd <- num/denom
var_crd
eff <- ((v_rcbd + 1)*(v_crd + 3))/((v_rcbd + 3) * (v_crd + 1)) * (var_crd/MSE)
eff
eff
eff
8*1.96
tire_data
mean_diff <- mean(tire_data$wearRate %>% filter(brand == "A")) - mean(tire_data$wearRate %>% filter(brand != "A"))
library(tidyverse)
library(tidyverse)
mean_diff <- mean(tire_data$wearRate %>% filter(brand == "A")) - mean(tire_data$wearRate %>% filter(brand != "A"))
mean_diff <- mean(tire_data$wearRate %>% filter(brand == "A")) - mean(tire_data$wearRate %>% filter(brand != "A"))
mean_diff <- mean(tire_data$wearRate %>% filter(brand = "A")) - mean(tire_data$wearRate %>% filter(brand != "A"))
mean_diff <- mean(tire_data$wearRate[tire_data$brand == "A"]) -
mean(tire_data$wearRate[tire_data$brand != "A"])
mean_diff
c <- c(1,-1/3,-1/3,-1/3)
n <- 8
se_l <- sqrt(MSE * sum(c^2 / n))
se_l
l_hat <- mean(tire_data$wearRate[tire_data$brand == "A"]) -
mean(tire_data$wearRate[tire_data$brand != "A"])
c <- c(1,-1/3,-1/3,-1/3)
n <- 8
se_l <- sqrt(MSE * sum(c^2 / n))
t <- l_hat / se_l
t
p_val <- pt(t, df=21, lower.tail=FALSE)
p_val
contrast_est + c(-1,1)* t_crit * SE_contrast
mean_A <- mean(wearRate[brand == "A"])
mean_B <- mean(wearRate[brand == "B"])
mean_C <- mean(wearRate[brand == "C"])
mean_D <- mean(wearRate[brand == "D"])
# Contrast estimate
mean_BCD <- (mean_B + mean_C + mean_D) / 3
contrast_est <- mean_A - mean_BCD
# Standard error
MS_E <- 0.2503
n <- 8
SE_contrast <- sqrt(MS_E * (1/n + (1/3)^2/n + (1/3)^2/n + (1/3)^2/n))
# Simplified: SE_contrast <- sqrt(MS_E * (1/n + 3*(1/9)/n))
SE_contrast <- sqrt(MS_E * (1/8 + 1/24))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
# Simplified: SE_contrast <- sqrt(MS_E * (1/n + 3*(1/9)/n))
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
C = c(1,-1/3,-1/3,-1/3)
SE_contrast
# Simplified: SE_contrast <- sqrt(MS_E * (1/n + 3*(1/9)/n))
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
SE_contrast
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
C = c(1,-1/3,-1/3,-1/3)
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
?glht()
install.packages("multcomp")
?glht()
library(multcomp)
?glht()
library(multcomp)
# Define contrast matrix
contrast_mat <- rbind("A vs BCD" = c(1, -1/3, -1/3, -1/3))
# Perform contrast test
contrast_test <- glht(model, linfct = mcp(brand = contrast_mat))
summary(contrast_test)
confint(contrast_test)
contrast_est + c(-1,1)* t_crit * SE_contrast
p_value
# Contrast estimate
mean_CD <- (mean_C + mean_D) / 3
contrast_est <- mean_B - mean_CD
# Standard error
MS_E <- 0.2503
n <- 8
C = c(0,1,-1/2,-1/2)
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
SE_contrast
contrast_est
# Contrast estimate
mean_CD <- (mean_C + mean_D) / 2
contrast_est <- mean_B - mean_CD
# Standard error
MS_E <- 0.2503
n <- 8
C = c(0,1,-1/2,-1/2)
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
p_value
p_value
contrast_est + c(-1,1)* t_crit * SE_contrast
C = c(0,0,1,-1)
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
contrast_est <- mean_C - mean_C
C = c(0,0,1,-1)
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
mean_D
mean_C
contrast_est <- mean_C - mean_D
C = c(0,0,1,-1)
SE_contrast <- sqrt(MS_E * sum(C^2 / n))
# Test statistic
t_stat <- contrast_est / SE_contrast
# P-value
p_value <- 2 * pt(-abs(t_stat), df = 21)
# Confidence interval
t_crit <- qt(0.975, df = 21)
contrast_est + c(-1,1)* t_crit * SE_contrast
p_value
SS <- (sum(C*means))^2 / sum(C^2 / n)
means <- c(mean_B, mean_C, mean_D)
SS <- (sum(C*means))^2 / sum(C^2 / n)
means
SS
means
# 2DF test
tire_subset <- tire_data[tire_data$brand %in% c("B", "C", "D"), ]
tire_subset$brand <- droplevels(tire_subset$brand)
# Fit RCBD model on subset
model_BCD <- aov(wearRate ~ airplane + brand, data=tire_subset)
summary(model_BCD)
pf(2.203, 2, lower.tail=F)
pf(2.203, 2, 14, lower.tail=F)
square <- factor(rep(1:2, each=16))
row <- factor(rep(1:4, times=8))  # Rows reused across squares
col <- factor(c(rep(1:4, each=4), rep(5:8, each=4)))  # Columns NOT reused
data <- data.frame(
y = y,
trt = factor(trt),
square = square,
row = row,
col = col
)
# Homework 5 Q2 Be sure to pay attention to the input order here
trt <- c("D", "B", "C", "A", "C", "A", "D",
"B", "B", "D", "A", "C", "A", "C",
"B", "D", "B", "D", "A", "C", "C",
"A", "D", "B", "A", "C", "B", "D",
"D", "B", "C", "A")
y <- c(44, 26, 67, 77, 39, 45, 71, 74,
52, 49, 81, 88, 73, 58, 76, 100,
51, 62, 71, 49, 63, 74, 67, 47,
74, 75, 60, 58, 82, 79, 74, 68)
square <- factor(rep(1:2, each=16))
row <- factor(rep(1:4, times=8))  # Rows reused across squares
col <- factor(c(rep(1:4, each=4), rep(5:8, each=4)))  # Columns NOT reused
data <- data.frame(
y = y,
trt = factor(trt),
square = square,
row = row,
col = col
)
data
model <- aov(y ~ square + row + col + trt, data=data)
summary(model)
anova_table <- summary(model)
print(anova_table)
summary(model)
# Homework 5 Q2 Be sure to pay attention to the input order here
trt <- c("D", "B", "C", "A", "C", "A", "D",
"B", "B", "D", "A", "C", "A", "C",
"B", "D", "B", "D", "A", "C", "C",
"A", "D", "B", "A", "C", "B", "D",
"D", "B", "C", "A")
y <- c(44, 26, 67, 77, 39, 45, 71, 74,
52, 49, 81, 88, 73, 58, 76, 100,
51, 62, 71, 49, 63, 74, 67, 47,
74, 75, 60, 58, 82, 79, 74, 68)
square <- factor(rep(1:2, each=16))
row <- factor(rep(1:4, times=8))  # Rows reused across squares
col <- factor(c(rep(1:4, each=4), rep(5:8, each=4)))  # Columns NOT reused
data <- data.frame(
y = y,
trt = factor(trt),
square = square,
row = row,
col = col
)
model <- aov(y ~ square + row + col + trt, data=data)
summary(model)
TukeyHSD(model)
TukeyHSD(model)$trt
summary(model)
trt <- c("D", "B", "C", "A", "C", "A", "D",
"B", "B", "D", "A", "C", "A", "C",
"B", "D", "B", "D", "A", "C", "C",
"A", "D", "B", "A", "C", "B", "D",
"D", "B", "C", "A")
y <- c(44, 26, 67, 77, 39, 45, 71, 74,
52, 49, 81, 88, 73, 58, 76, 100,
51, 62, 71, 49, 63, 74, 67, 47,
74, 75, 60, 58, 82, 79, 74, 68)
square <- gl(2, 16)
row <- rep(gl(4, 4), 2)
col <- rep(rep(1:4, each = 4), 2)
latin_data <- data.frame(square, row, col, trt, y)
model <- aov(y ~ trt + square + row + col, data = latin_data)
summary(model)
TukeyHSD(model, "trt", conf.level = 0.95)
plot(TukeyHSD(model, "trt", conf.level = 0.95))
plot(TukeyHSD(model, "trt", conf.level = 0.95))
plot(TukeyHSD(model, "brand", conf.level = 0.95))
model <- aov(wearRate ~ airplane + brand, data=tire_data)
summary(model)
TukeyHSD(model)$brand
plot(TukeyHSD(model, "brand", conf.level = 0.95))
# Homework 5 Q2 Be sure to pay attention to the input order here
trt <- c("D", "B", "C", "A", "C", "A", "D",
"B", "B", "D", "A", "C", "A", "C",
"B", "D", "B", "D", "A", "C", "C",
"A", "D", "B", "A", "C", "B", "D",
"D", "B", "C", "A")
y <- c(44, 26, 67, 77, 39, 45, 71, 74,
52, 49, 81, 88, 73, 58, 76, 100,
51, 62, 71, 49, 63, 74, 67, 47,
74, 75, 60, 58, 82, 79, 74, 68)
square <- factor(rep(1:2, each=16))
row <- factor(rep(1:4, times=8))  # Rows reused across squares
col <- factor(c(rep(1:4, each=4), rep(5:8, each=4)))  # Columns NOT reused
data <- data.frame(
y = y,
trt = factor(trt),
square = square,
row = row,
col = col
)
model <- aov(y ~ square + row + col + trt, data=data)
summary(model)
TukeyHSD(model)$trt
plot(TukeyHSD(model, "trt", conf.level = 0.95))
summary(model)
data
plot(TukeyHSD(model, "trt", conf.level = 0.99))
setwd("C:/Users/ASUS/OneDrive/Desktop/STAT 495 - Consulting")
